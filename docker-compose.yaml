# ============================================================================
# KORTIX SUPER WORKER DOCKER COMPOSE - LOCAL DEVELOPMENT
# ============================================================================
# This Docker Compose file runs Kortix Super Worker services (Frontend, Redis)
#
# Note: The backend has been moved to a separate repository.
# This compose file now only manages frontend and supporting infrastructure.
#
# Quick Start:
#   docker compose up -d          # Start all services
#   docker compose down           # Stop all services
#   docker compose logs -f        # View all logs
#
# Access:
#   - Kortix Super Worker Frontend:     http://localhost:3000
# ============================================================================

services:
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    command: redis-server --save 60 1 --loglevel warning
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 3

  frontend:
    init: true
    build:
      context: ./apps/frontend
      dockerfile: Dockerfile
      args:
        NEXT_PUBLIC_BACKEND_URL: ${NEXT_PUBLIC_BACKEND_URL:-http://localhost:8000/v1}
        NEXT_PUBLIC_URL: ${NEXT_PUBLIC_URL:-http://localhost:3000}
        NEXT_PUBLIC_ENV_MODE: ${NEXT_PUBLIC_ENV_MODE:-LOCAL}
    ports:
      - "3000:3000"
    depends_on:
      redis:
        condition: service_healthy

volumes:
  redis_data:
